before_script:
  - source "$(ccc_home -u mpc)/gitlab-runner/spack_organizer_inti/setup.sh"
  - spack env activate pcvs
  # - pip3 install '.[dev]'

variables:
    GIT_CLEAN_FLAGS: -fddx -e .coverage

.scope: &scope
    only:
    - master
    - devel
    - merge_requests
    - web

stages:
- Installation
- Lints
- Tests
- Documentation

Install PCVS:
    <<: *scope
    stage: Installation
    script:
    - pip install '.[dev]'
    - pcvs --version

Lint PCVS:
    <<: *scope
    stage: Lints
    script:
    - tox -e pcvs-lint

Coverage PCVS:
    <<: *scope
    stage: Tests
    script:
    - tox -e pcvs-coverage

Build Doc:
    <<: *scope
    stage: Documentation
    script:
    - tox -e doc

Lint Doc:
    <<: *scope
    stage: Documentation
    script:
    - tox -e doc-lint

Test Doc:
    <<: *scope
    stage: Documentation
    script:
    - tox -e doc-coverage

